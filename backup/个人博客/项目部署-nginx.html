<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Nginx | Mannix Chen’s Blog</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Nginx" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is a wonderful website about awesome stuff." />
<meta property="og:description" content="This is a wonderful website about awesome stuff." />
<link rel="canonical" href="https://mannixchen.github.io/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-nginx.html" />
<meta property="og:url" content="https://mannixchen.github.io/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-nginx.html" />
<meta property="og:site_name" content="Mannix Chen’s Blog" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Nginx" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"This is a wonderful website about awesome stuff.","headline":"Nginx","url":"https://mannixchen.github.io/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-nginx.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://mannixchen.github.io/feed.xml" title="Mannix Chen&apos;s Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Mannix Chen&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/backup/2023-12-21-01-file-management.html">文档管理系统</a><a class="page-link" href="/backup/2023-12-21-02-git-sync-github.html">本地 git 仓同步到 github 新库</a><a class="page-link" href="/backup/centos7.html">Update git from v1.8 - v2.x</a><a class="page-link" href="/backup/sub/finalcutpro.html">添加 keyword</a><a class="page-link" href="/backup/sub/javaLearn.html">Java 基本程序设计结构</a><a class="page-link" href="/backup/sub/vloganalyze.html">越南notebook感悟</a><a class="page-link" href="/backup/sub/%E5%BF%83%E6%B5%81.html">第一章</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/WAKE%20UP.html">wake up(2018.9) - casey day</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/bean.html">bean</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ghost%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E5%92%8C%E9%85%8D%E7%BD%AE.html">ghost个人博客搭建 ( centos 7 ) 和配置 ( 汉化 - 搜索 - 评论 )</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ghost%E9%85%8D%E7%BD%AE.html">ghost博客配置</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E4%B8%9A%E7%95%8C%E7%99%BB%E5%BD%95%E6%8C%87%E5%8D%97.html">登录 - 业界解决方案</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92.html">学习计划</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8.html">组件</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E6%80%8E%E4%B9%88%E7%94%A8Nodejs%E5%86%99%E7%99%BB%E5%BD%95.html">用 Nodejs 写登录功能</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E6%94%BE%E4%B8%8B.html">放下</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E6%96%B0%E7%94%B5%E8%84%91-%E6%96%B0%E6%89%A9%E5%B1%95%E5%9D%9E-%E6%B6%B2%E5%8E%8B%E8%87%82.html">年中换新机, 22日官网下单</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E8%AF%BB%20vue3%20%E6%96%87%E6%A1%A3.html">Getting Started</a><a class="page-link" href="/backup/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-nginx.html">Nginx</a><a class="page-link" href="/backup/%E6%80%9D%E8%80%83%F0%9F%A4%94.html">思考</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0726.html">雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0727.html">小雨转各种雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0728.html">雨 -&amp;gt; 阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0729.html">阴 -&amp;gt; 多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0730.html">大晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0731.html">大晴 - 愉快学习, 缺乏运动</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0801.html">大晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0802.html">晴/阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0803.html">晴日, 偶有多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0804.html">晴天</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0805.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0806.html">晴/多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0807.html">妥妥的多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0808.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0809.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0810.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0811.html">阴 -&amp;gt; 雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0812.html">阴 -&amp;gt; 小雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0813.html">大雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0814.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0815.html">阴雨 -&amp;gt; 连着好几天</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0816.html">雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0817.html">美好的晴天</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0818.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0819.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0820.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0821.html">阴-&amp;gt;晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0822.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0823.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0824.html">阴 -&amp;gt; 雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0825.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0826.html">阴 -&amp;gt; 雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0827.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0828.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0829.html">大雨滂沱</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0830.html">阴 -&amp;gt; 多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0831.html">晴, 大晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0901.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0902.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0903.html">阴 -&amp;gt; 晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0904.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0905.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0906.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0907.html">多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0908.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0909.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0910.html">大晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0911.html">大晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0912.html">多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0913.html">台风天-灿都</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0914.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0915.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0916.html">晴天</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0917.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0918.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0919.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0920.html">阴 -&amp;gt; 多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0921.html">晴 -&amp;gt; 中秋</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0922.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0923.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0924.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0925.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0926.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0927.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0928.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/0929.html">雨</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1017.html">多云</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1029.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1030.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1031.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1101.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1103.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1104.html">阴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1105.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1106.html">晴, 但是冷</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1107.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1108.html">晴, 也冷</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1109.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1110.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1111.html">晴, 空气贼好</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1112.html">空气好</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1113.html">空气也不错</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1114.html">无</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1115.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1116.html">晴</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1117.html">异步函数</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1120.html">JDK</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/2021/1121.html">类名字 - 标识符</a><a class="page-link" href="/backup/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/Becoming%20Steve%20Jobs.html">Prologue /’prolɔɡ/ 序言开场白</a><a class="page-link" href="/backup/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/Vim%E7%AF%87.html">https://vim.rtorr.com/lang/en_us</a><a class="page-link" href="/backup/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%B2%9B%E4%B8%8A%E4%B9%A6%E5%BA%97%E8%AF%BB%E5%90%8E%E6%84%9F.html">过年和年后的日子 - 多年未看的</a><a class="page-link" href="/backup/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%B9%B8%E7%A6%8F%E7%9A%84%E6%96%B9%E6%B3%95%E8%AF%BB%E5%90%8E%E6%84%9F.html">幸福的方法</a><a class="page-link" href="/">Blog Posts</a><a class="page-link" href="/backup/">blog</a><a class="page-link" href="/backup/%E6%97%A5%E5%BF%97/">JavaScript 忍者秘籍🥷 0729-0814</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Nginx</h1>
  </header>

  <div class="post-content">
    <h1 id="nginx">Nginx</h1>

<blockquote>
  <p>高并发, 占用更少的内存和资源, 善于处理静态文件</p>

  <p>配置简单(nginx.conf), 运行简单</p>
</blockquote>

<h4 id="安装">安装</h4>

<p>……</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">--</span><span class="nx">ubuntu</span>
<span class="nx">apt</span> <span class="nx">install</span> <span class="nx">nginx</span>
<span class="o">--</span><span class="nx">判断是否安装成功</span>
<span class="nx">nginx</span> <span class="o">-</span><span class="nx">v</span>
<span class="o">--</span><span class="nx">三个常用目录</span>
<span class="mi">1</span><span class="p">.</span><span class="nx">etc</span><span class="o">/</span><span class="nx">nginx</span>
<span class="mi">2</span><span class="p">.</span><span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">nginx</span> <span class="nx">日志目录</span>
<span class="mi">3</span><span class="p">.</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">share</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">html</span><span class="o">/</span> <span class="nx">默认首页目录</span>

<span class="nx">常用操作内容</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">nginx</span><span class="o">/</span><span class="nx">conf</span><span class="p">.</span><span class="nx">d</span> 	<span class="c1">// 配置文件目录</span>
<span class="mi">2</span><span class="p">.</span> <span class="nx">nginx</span><span class="o">/</span><span class="nx">nginx</span><span class="p">.</span><span class="nx">conf</span> <span class="c1">// 全局配置文件 -&gt; 通过inclue导入配置文件 include /etc/nginx/conf.d/*.conf;</span>





</code></pre></div></div>

<h4 id="远程连接配置文件">远程连接配置文件</h4>

<blockquote>
  <p>vscode为例</p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="p">.</span> <span class="nx">安装SFTP</span> <span class="nx">插件</span>
<span class="mi">2</span><span class="p">.</span> <span class="nx">控制面板</span><span class="o">-&gt;</span> <span class="nx">输入sftp</span>
<span class="mi">3</span><span class="p">.</span> <span class="nx">自动生成文件进行配置</span>
<span class="mi">4</span><span class="p">.</span> <span class="nx">右键downloadfolder</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/20210228162439.png" alt="" /></p>

<blockquote>
  <p>连接完就可以在vscode中进行文本编辑</p>
</blockquote>

<h4 id="nginx配置段">nginx配置段</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">user</span> <span class="s">-用户名</span>
<span class="s">worker_processes</span> <span class="s">-多进程</span>
<span class="s">pid</span> <span class="s">-指定进程号的</span>
<span class="s">events</span> <span class="p">{</span>
    <span class="kn">worker_conection:</span> <span class="s">-最多连接数</span>
<span class="err">}</span>
<span class="s">http</span> <span class="p">{</span>
     <span class="kn">-可以导入server配置段内容</span>
        <span class="s">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">80</span> <span class="s">-必填</span>
        <span class="s">server_name:</span> <span class="s">-给你的监听的服务命名一个名字,</span> <span class="s">也可以不指定</span>
        <span class="s">location</span> <span class="n">/</span> <span class="p">{</span> <span class="kn">-匹配规则</span>
            <span class="s">root</span> <span class="n">/etc/nginx/html</span><span class="p">;</span> <span class="kn">-指定文件目录</span>
            <span class="s">index</span> <span class="s">index.html</span><span class="p">;</span> <span class="kn">-指定返回的首页文件</span>
        <span class="err">}</span>
    <span class="err">}</span>
<span class="err">}</span>
<span class="s">-一般我们在conf.d中进行server配置</span>

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/http-Nginx-http-conf.png" alt="" /></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nginx</span> <span class="o">-</span><span class="nx">t</span> <span class="c1">//测试nginx是否测试通过</span>
<span class="nx">nginx</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">reload</span> <span class="c1">// nginx重载</span>

</code></pre></div></div>

<h4 id="nginx路径匹配优先级">nginx路径匹配优先级</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 通用匹配</span>
<span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">return</span> <span class="mi">400</span><span class="p">;</span> <span class="kn">-返回状态码</span>
<span class="err">}</span>
<span class="c1"># 精确匹配 优先级最高***</span>
<span class="s">location</span> <span class="p">=</span> <span class="n">/</span> <span class="p">{</span>
	<span class="kn">return</span> <span class="mi">400</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1"># 优先匹配 优先级别第二**</span>
<span class="kn">location</span> <span class="p">~</span> <span class="sr">/</span> <span class="p">{</span>
    <span class="kn">return</span> <span class="mi">402</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="try_files-和return的使用区别">try_files 和return的使用区别</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># try_files 对根路径匹配无效</span>
<span class="k">location</span> <span class="n">/a</span> <span class="p">{</span> 
    <span class="c1">#try_files 无法处理根路径</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">400</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1"># try_files 配合@使用 </span>
<span class="k">location</span> <span class="n">/a</span> <span class="p">{</span> 
    <span class="c1">#try_files 无法处理根路径</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="s">@meiduo</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">location</span> <span class="s">@meiduo</span> <span class="p">{</span>
    <span class="kn">return</span> <span class="mi">402</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#return 使用跳转</span>
<span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">return</span> <span class="mi">302</span> <span class="s">http://www.baidu.com</span><span class="p">;</span>  <span class="kn">-return</span> <span class="s">重定向</span>
<span class="err">}</span>
</code></pre></div></div>

<h4 id="匹配路径后面的斜杠问题">匹配路径后面的斜杠问题</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="n">/a</span> <span class="p">{</span> <span class="c1">#没有斜杠  ip/a &amp;&amp; ip/a/都可以访问</span>
    <span class="kn">return</span> <span class="mi">400</span><span class="p">;</span>  
<span class="p">}</span>
<span class="k">location</span> <span class="n">/a/</span> <span class="c1">#加了斜杠  ip/a 不可以访问</span>
</code></pre></div></div>

<h4 id="root和alias使用和区别">root和alias使用和区别</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#根路径</span>
<span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="n">/etc/nginx/html</span>
    <span class="c1"># 如果指定目录下, 会自动加载index.html</span>
    <span class="c1"># 如果想指定其他文件, 添加index属性</span>
    <span class="s">index</span> <span class="mi">8000</span><span class="s">.html</span>
<span class="err">}</span>

<span class="s">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">alias</span> <span class="n">/etc/nginx/html/</span>
    <span class="c1"># alias后面需要加上斜杠</span>
<span class="err">}</span>
<span class="c1">#指定路径</span>
<span class="s">location</span> <span class="n">/a</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="n">/etc/nginx/html</span>
    <span class="c1"># 是无法默认加载指定路径下的index.html</span>
<span class="err">}</span>

<span class="s">location</span> <span class="n">/a</span> <span class="p">{</span>
    <span class="kn">alias</span> <span class="n">/etc/nginx/html</span>
    <span class="c1"># alias可以默认访问到路径下的index.html</span>
<span class="err">}</span>
</code></pre></div></div>

<h4 id="访问权限控制">访问权限控制</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 我允许指定客户端来访问我</span>
<span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
    <span class="kn">stub_status</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># 返回nginx的状态信息</span>
    <span class="kn">allow</span> <span class="mi">10</span><span class="s">.211.55.30</span><span class="p">;</span> <span class="c1"># 指定哪个ip的客户端访问 </span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span> <span class="c1"># 除了允许的其他都拒绝</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="目录下载控制">目录下载控制</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="n">/download</span> <span class="p">{</span>
    <span class="kn">alias</span> <span class="n">/etc/nginx</span><span class="p">;</span>
    <span class="kn">autoindex</span> <span class="no">on</span><span class="p">;</span> <span class="c1">#开启目录下载服务</span>
    
<span class="p">}</span>
</code></pre></div></div>

<h4 id="反向代理的使用">反向代理的使用</h4>

<blockquote>
  <p>可以隐藏服务器ip</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">举个例子: </code>请求域名的80端口, 此时nginx再把请求转发到了8000端口</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">conf</span>
<span class="nx">server</span> <span class="p">{</span>
    <span class="nx">listen</span> <span class="nx">ip</span><span class="p">:</span><span class="mi">80</span>
    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="nx">proxy_pass</span> <span class="na">http</span><span class="p">:</span><span class="c1">//ip:8000; # 用户访问80, 此时代理给了8000, 让下面的8000端口来处理</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">server</span> <span class="p">{</span>
    <span class="nx">listen</span> <span class="nx">ip</span><span class="p">:</span> <span class="mi">8000</span><span class="p">;</span>
    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
      <span class="nx">root</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">nginx</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span>
      <span class="nx">index</span> <span class="mi">8000</span><span class="p">.</span><span class="nx">html</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="负载均衡的使用">负载均衡的使用</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#负载均衡的启用</span>
<span class="k">upstream</span> <span class="s">name</span> <span class="p">{</span>
    <span class="c1">#默认是轮询</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8001</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8002</span><span class="p">;</span>
    <span class="c1">#加权轮询</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8000</span> <span class="s">weight=1</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8001</span> <span class="s">weight=2</span><span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8002</span> <span class="s">weight=3</span><span class="p">;</span> <span class="c1">#权重越大, 出现的机率越高, 数字越大权重越大</span>
    <span class="c1"># ip_hash</span>
    <span class="c1">#第一次请求的时候, 会分配一个服务端ip, 以后的所有请求都是用第一次的服务ip</span>
    <span class="kn">ip_hash</span><span class="p">;</span> <span class="c1">#开通ip_hash访问 </span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8000</span> <span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8001</span> <span class="p">;</span>
    <span class="kn">server</span> <span class="nf">ip</span><span class="p">:</span><span class="mi">8002</span> <span class="p">;</span>
<span class="p">}</span>
<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://upstream-name</span> 
    <span class="err">}</span>
<span class="err">}</span>
<span class="c1"># 代理为upstream, 可以解决负载均衡的问题, 访问http://upstream-name分流访问指定的server, 释放服务器压力(默认是轮询的方法-一个个来)</span>
</code></pre></div></div>

<h4 id="日志使用">日志使用</h4>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">/var/log/nginx</code></p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">定制日志内容</code>: nginx.conf</p>

<p>配置日志格式使用的是<code class="language-plaintext highlighter-rouge">log_format</code>属性</p>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/20210301125118.png" alt="" /></p>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/20210301125410.png" alt="带准确ip日志详细配置" /></p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#logging setting</span>
<span class="c1">#需求: 在转发时候携带上真实ip地址, 需要在转发时候把地址放到header里面</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/20210228181731.png" alt="" /></p>

<p><img src="https://raw.githubusercontent.com/mannixchan/Pics/master/img/20210228182047.png" alt="" /></p>

<h4 id="部署实践">部署实践</h4>

<blockquote>
  <p>重定向到其他网站</p>
</blockquote>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
            <span class="kn">return</span> <span class="mi">302</span> <span class="s">http://www.baidu.com</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>在服务器配置了多个服务, 想通过不同网址后缀, 访问不同的服务</p>
</blockquote>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">listen</span> <span class="mi">8000</span><span class="p">;</span>
		<span class="k">location</span> <span class="n">/sell</span> <span class="p">{</span>
            <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8010</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">location</span> <span class="n">/music</span> <span class="p">{</span>
            <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8020</span><span class="p">;</span>
        <span class="p">}</span>
<span class="c1">#想通过-网址/sell -网址/music访问到不同的项目, 静态文件地址, 并且反向代理到其他端口</span>
    <span class="k">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">8020</span><span class="p">;</span>
        <span class="kn">location</span> <span class="n">/music</span> <span class="p">{</span>
            <span class="kn">alias</span> <span class="n">/root/www/vueMusci</span><span class="p">;</span>
        <span class="p">}</span>
<span class="c1">#此时访问8000/music, 就会转发到8020/music, 注意转发的时候会带着/music一起转发, 所以配置8020要带着/music</span>
<span class="c1">#注意-root和alias的用法</span>
    <span class="c1">#exeample</span>
        <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">8020</span><span class="p">;</span>
        <span class="kn">location</span> <span class="n">/music</span> <span class="p">{</span>
            <span class="kn">alias</span> <span class="n">/root/www/vueMusci</span><span class="p">;</span> <span class="c1">#此时会默认寻找/root/www/vueMusci下的index.html</span>
        <span class="p">}</span>
        
         <span class="kn">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">8020</span><span class="p">;</span>
        <span class="kn">location</span> <span class="n">/music</span> <span class="p">{</span>
            <span class="kn">root</span> <span class="n">/root/www/vueMusci</span><span class="p">;</span> <span class="c1">#会寻找/root/www/vueMusci/music下的index.html, root会拼接location觉得地址</span>
        <span class="p">}</span>
    <span class="c1"># 所以一般/...一般使用alias, 除了根目录都用alias</span>
</code></pre></div></div>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Mannix Chen&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Mannix Chen&#39;s Blog</li><li><a class="u-email" href="mailto:job@mannixchen.com">job@mannixchen.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is a wonderful website about awesome stuff.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
